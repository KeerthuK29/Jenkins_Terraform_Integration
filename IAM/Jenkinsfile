pipeline {
  agent any

  parameters {
    string(name: 'action', values: ['plan', 'apply', 'destroy'], description: 'Terraform action to perform')
  }

  stages {
    stage('Checkout Code') {
      steps {
        git branch: 'master', url:'https://github.com/KeerthuK29/Terraform-with-Jenkins.git'
      }
    }
    stage('Terraform run'){
      steps{
        bat 'terraform init'
      }
    }
    stage('Terraform Action') {
      when {
        expression { return params.action == 'plan' }
      }
      steps {
        bat "terraform plan"
      }
    }
    stage('Terraform Apply ') {
      when {
        expression { return params.action == 'apply' }
      }
      steps {
        bat "terraform apply"
      }
    }
    
  }
}
